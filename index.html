<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>üìö Kiddo Book Stall</title>
<style>
  :root{
    --bg:#0f1724; --panel:#0b1220; --muted:#9fb0c4;
    --accent1:#00ffd0; --accent2:#00a8ff; --gold1:#ffd200;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family: "Poppins", Inter, system-ui, sans-serif;
    background: linear-gradient(180deg,#071022,#0f1724);
    color:#e6eef8; min-height:100vh; display:flex; flex-direction:column;
  }

  /* Header (long-press to show login) */
  header{
    padding:16px; text-align:center;
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    color:#001; font-weight:800; font-size:18px;
    border-bottom-left-radius:18px; border-bottom-right-radius:18px;
    box-shadow:0 6px 20px rgba(0,0,0,0.35);
    position:relative;
  }
  header small{ display:block; font-weight:600; color:#032; margin-top:6px; font-size:12px }

  main{ flex:1; width:100%; max-width:980px; margin:14px auto; padding:12px; }

  /* Grid */
  .grid{
    display:grid; gap:12px;
    grid-template-columns: repeat(auto-fit, minmax(170px, 1fr));
  }

  /* Card */
  .card{
    background: rgba(255,255,255,0.03);
    border-radius:14px; padding:14px; display:flex; flex-direction:column;
    align-items:center; gap:8px; min-height:170px;
    box-shadow:0 6px 18px rgba(0,0,0,0.45); transition:transform .18s ease;
  }
  .card:hover{ transform: translateY(-6px); }
  .emoji{ font-size:44px }
  .title{ color:var(--accent1); font-weight:800; font-size:15px; text-align:center; }
  .desc{ color:var(--muted); font-size:13px; text-align:center; flex:1; display:flex; align-items:center; justify-content:center; padding:0 8px }

  .row{ display:flex; gap:8px; align-items:center; justify-content:center; width:100%; margin-top:6px }
  .btn{
    background: linear-gradient(90deg,var(--accent1),var(--accent2));
    color:#001; padding:8px 12px; border-radius:999px; font-weight:800; border:none; cursor:pointer;
    display:inline-flex; gap:8px; align-items:center; text-decoration:none;
  }
  .btn.ghost{ background:transparent; border:1px solid rgba(255,255,255,0.06); color:var(--muted); padding:7px 10px; font-weight:700; }

  /* bottom actions */
  .actions{ margin-top:18px; display:flex; gap:12px; align-items:center; justify-content:center; flex-wrap:wrap; }
  .big-btn{ background: linear-gradient(90deg,var(--gold1),#ff8a00); color:#001; padding:12px 20px; border-radius:999px; font-weight:800; border:none; cursor:pointer; box-shadow:0 10px 30px rgba(255,140,0,0.14); }

  /* status / small toast */
  .status{ color:var(--muted); font-size:13px; text-align:center; margin-top:8px }

  /* Admin overlay / modal */
  .modal-backdrop{ position:fixed; inset:0; background:rgba(0,0,0,0.6); display:none; align-items:center; justify-content:center; z-index:90; }
  .modal{ background:linear-gradient(180deg,#0b1220,#0f1724); color:#e6eef8; padding:16px; border-radius:12px; width:92%; max-width:520px; box-shadow:0 10px 40px rgba(0,0,0,0.6); }
  .modal h3{ margin:0 0 8px; font-size:18px }
  .row-input{ display:flex; gap:8px; margin-top:10px }
  .row-input input, textarea, select{
    flex:1; padding:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.06); background:rgba(255,255,255,0.02); color:#e6eef8;
  }
  .modal .small{ font-size:13px; color:var(--muted); margin-top:6px }

  /* Admin dashboard area */
  #adminPanel{ display:none; position:fixed; right:12px; top:80px; width:92%; max-width:420px; z-index:80; background:linear-gradient(180deg,#06111a,#081523); border-radius:12px; padding:12px; box-shadow:0 12px 40px rgba(0,0,0,0.6); color:#dfeeff }
  #adminPanel h4{ margin:0 0 8px; font-size:16px }
  .admin-row{ display:flex; gap:8px; align-items:center; justify-content:space-between; padding:8px 0; border-bottom:1px dashed rgba(255,255,255,0.03) }
  .admin-list{ max-height:52vh; overflow:auto; margin-top:8px; padding-right:6px }

  .small-btn{ padding:6px 8px; border-radius:8px; font-weight:700; background:rgba(255,255,255,0.02); color:#dff; border:1px solid rgba(255,255,255,0.03); cursor:pointer; }

  footer{ text-align:center; padding:12px 10px; color:var(--muted); font-size:13px; margin-top:12px }

  @media (max-width:420px){
    .emoji{ font-size:40px }
  }
</style>
</head>
<body>

<header id="siteHeader">
  üìö Kiddo Book Stall
  <small>‡¶ú‡ßÅ‡¶¨‡¶æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶∏‡ßç‡¶Ø‡¶æ‡¶∞ ‡¶è‡¶∞ ‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∏‡ßÅ‡¶≤ (‡ßß‚Äì‡ß´) ‚Äî long-press to admin</small>
</header>

<main>
  <div class="grid" id="grid"></div>

  <div class="actions">
    <button id="downloadAll" class="big-btn">‚¨áÔ∏è ‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®</button>
    <div class="status" id="status">‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‚Äî ‡ß´‡¶ü‡¶ø ‡¶´‡¶æ‡¶á‡¶≤</div>
  </div>
</main>

<!-- Admin Panel (hidden, toggled after login) -->
<div id="adminPanel" aria-hidden="true">
  <h4>üîê Admin Dashboard</h4>
  <div class="admin-row"><div>‡¶Æ‡ßã‡¶ü Downloads</div><div id="totalDownloads">0</div></div>
  <div class="admin-row"><div>‡¶´‡¶æ‡¶á‡¶≤ ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ</div><div id="totalBooks">0</div></div>

  <div style="margin-top:8px; font-weight:800">üìö Books</div>
  <div class="admin-list" id="adminBookList"></div>

  <div style="margin-top:10px;">
    <button id="openAdd" class="small-btn">‚ûï Add New Book</button>
    <button id="closeAdmin" class="small-btn" style="float:right">üîí Hide Admin</button>
  </div>
</div>

<!-- Modal / Login & Add/Edit -->
<div class="modal-backdrop" id="modalBackdrop">
  <div class="modal" id="modalContent">
    <!-- content injected -->
  </div>
</div>

<footer>¬© ‡ß®‡ß¶‡ß®‡ß´ ‚Ä¢ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßá‡¶õ‡ßá‡¶® ‚ù§Ô∏è Kamrul</footer>

<script>
/*
  Kiddo Book Stall ‚Äî Admin-enabled single-file app
  - Long-press header (1.2s) to open login modal
  - Default admin password: kiddo2025  (change below if you want)
  - Data stored in localStorage: 'kiddo_books' and 'kiddo_stats' and 'kiddo_admin_pass'
*/

/* ------------------ Config / defaults ------------------ */
const DEFAULT_ADMIN_PASS = 'kiddo2025'; // change in code if you want different password
// Initial books array (from user supplied raw links). If any link 404s, edit via admin panel.
const DEFAULT_BOOKS = [
  { id: genId(), emoji:'üìó', title:'‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∏‡ßÅ‡¶≤ ‡ßß', desc:'‡¶∏‡¶æ‡¶Æ‡ßç‡¶™‡ßç‡¶∞‡¶§‡¶ø‡¶ï ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶™‡ßç‡¶∞‡¶∂‡ßç‡¶®‡¶æ‡¶¨‡¶≤‡¶ø', url:'https://raw.githubusercontent.com/kamrul-nova-06/Kiddo-kamrul/main/%E0%A6%B8%E0%A6%BE%E0%A6%AE%E0%A7%8D%E0%A6%AA%E0%A7%8D%E0%A6%B0%E0%A6%A4%E0%A6%BF%E0%A6%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A7.pdf', downloads:0 },
  { id: genId(), emoji:'üìò', title:'‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∏‡ßÅ‡¶≤ ‡ß®', desc:'‡¶ö‡¶≤‡¶Æ‡¶æ‡¶® ‡¶ò‡¶ü‡¶®‡¶æ ‡¶¨‡¶ø‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶£', url:'https://raw.githubusercontent.com/kamrul-nova-06/Kiddo-kamrul/main/%E0%A6%B8%E0%A6%BE%E0%A6%AE%E0%A7%8D%E0%A6%AA%E0%A7%8D%E0%A6%B0%E0%A6%A4%E0%A6%BF%E0%A6%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A8.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A7.pdf', downloads:0 },
  { id: genId(), emoji:'üìô', title:'‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∏‡ßÅ‡¶≤ ‡ß©', desc:'‡¶¨‡¶ø‡¶∂‡ßá‡¶∑ ‡¶®‡ßã‡¶ü ‡¶ì ‡¶§‡¶•‡ßç‡¶Ø', url:'https://raw.githubusercontent.com/kamrul-nova-06/Kiddo-kamrul/main/%E0%A6%B8%E0%A6%BE%E0%A6%AE%E0%A7%8D%E0%A6%AA%E0%A7%8D%E0%A6%B0%E0%A6%A4%E0%A6%BF%E0%A6%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A9.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A8.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A7.pdf', downloads:0 },
  { id: genId(), emoji:'üìï', title:'‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∏‡ßÅ‡¶≤ ‡ß™', desc:'‡¶ö‡¶≤‡¶§‡¶ø ‡¶ò‡¶ü‡¶®‡¶æ‡¶¨‡¶≤‡¶ø‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶∏‡¶Ç‡¶ï‡ßç‡¶∑‡ßá‡¶™', url:'https://raw.githubusercontent.com/kamrul-nova-06/Kiddo-kamrul/main/%E0%A6%B8%E0%A6%BE%E0%A6%AE%E0%A7%8D%E0%A6%AA%E0%A7%8D%E0%A6%B0%E0%A6%A4%E0%A6%BF%E0%A6%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%AA.pdf5%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A9.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A8.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A7.pdf', downloads:0 },
  { id: genId(), emoji:'üìí', title:'‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∏‡ßÅ‡¶≤ ‡ß´', desc:'‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡ßç‡¶¨‡¶™‡ßÇ‡¶∞‡ßç‡¶£ ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ó‡¶æ‡¶ú‡¶ø‡¶® ‡¶ü‡¶æ‡¶á‡¶™ ‡¶§‡¶•‡ßç‡¶Ø', url:'https://raw.githubusercontent.com/kamrul-nova-06/Kiddo-kamrul/main/%E0%A6%B8%E0%A6%BE%E0%A6%AE%E0%A7%8D%E0%A6%AA%E0%A7%8D%E0%A6%B0%E0%A6%A4%E0%A6%BF%E0%A6%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%AB.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%AA.pdf5%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A9.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A8.pdf%95%20%E0%A6%95%E0%A7%8D%E0%A6%AF%E0%A6%BE%E0%A6%AA%E0%A6%B8%E0%A7%81%E0%A6%B2-%E0%A7%A7.pdf', downloads:0 }
];

// storage keys
const KEY_BOOKS = 'kiddo_books_v1';
const KEY_STATS = 'kiddo_stats_v1';
const KEY_ADMIN = 'kiddo_admin_v1';

/* ------------------ helpers ------------------ */
function genId(){ return 'b_'+Math.random().toString(36).slice(2,9); }
function saveBooks(list){ localStorage.setItem(KEY_BOOKS, JSON.stringify(list)); }
function loadBooks(){
  const s = localStorage.getItem(KEY_BOOKS);
  if(!s) { saveBooks(DEFAULT_BOOKS); return JSON.parse(JSON.stringify(DEFAULT_BOOKS)); }
  try { return JSON.parse(s); } catch(e){ saveBooks(DEFAULT_BOOKS); return JSON.parse(JSON.stringify(DEFAULT_BOOKS)); }
}
function saveStats(st){ localStorage.setItem(KEY_STATS, JSON.stringify(st)); }
function loadStats(){
  const s = localStorage.getItem(KEY_STATS);
  if(!s){ const st = { totalDownloads:0 }; saveStats(st); return st; }
  try{ return JSON.parse(s); }catch(e){ const st={totalDownloads:0}; saveStats(st); return st; }
}
function saveAdmin(a){ localStorage.setItem(KEY_ADMIN, JSON.stringify(a)); }
function loadAdmin(){
  const s = localStorage.getItem(KEY_ADMIN);
  if(!s){ const a = { pass: DEFAULT_ADMIN_PASS }; saveAdmin(a); return a; }
  try{return JSON.parse(s);}catch(e){ const a={pass:DEFAULT_ADMIN_PASS}; saveAdmin(a); return a; }
}

/* ------------------ init state ------------------ */
let books = loadBooks();
let stats = loadStats();
let admin = loadAdmin();

/* ------------------ render UI ------------------ */
const grid = document.getElementById('grid');
const status = document.getElementById('status');
const totalDownloadsEl = document.getElementById('totalDownloads');
const totalBooksEl = document.getElementById('totalBooks');
const adminPanel = document.getElementById('adminPanel');
const adminBookList = document.getElementById('adminBookList');

function renderBooks(){
  grid.innerHTML = '';
  books.forEach(b=>{
    const card = document.createElement('div'); card.className='card';
    card.innerHTML = `
      <div class="emoji">${b.emoji||'üìï'}</div>
      <div class="title">${escapeHtml(b.title)}</div>
      <div class="desc">${escapeHtml(b.desc)}</div>
      <div class="row">
        <button class="btn" data-id="${b.id}" data-action="download">‚¨áÔ∏è ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶°</button>
        <button class="btn ghost" data-url="${b.url}" data-action="open">üîó ‡¶ñ‡ßã‡¶≤‡¶æ</button>
      </div>
    `;
    grid.appendChild(card);
  });
  status.textContent = `‡¶™‡ßç‡¶∞‡¶∏‡ßç‡¶§‡ßÅ‡¶§ ‚Äî ${books.length} ‡¶´‡¶æ‡¶á‡¶≤`;
  totalBooksEl.textContent = books.length;
  totalDownloadsEl.textContent = stats.totalDownloads || 0;
  renderAdminList();
}

function renderAdminList(){
  adminBookList.innerHTML = '';
  books.forEach(b=>{
    const row = document.createElement('div'); row.className='admin-row';
    row.innerHTML = `
      <div style="flex:1">
        <div style="font-weight:800">${escapeHtml(b.title)} <span style="color:var(--muted);font-weight:600;font-size:12px">(${b.downloads||0})</span></div>
        <div style="font-size:12px;color:var(--muted)">${escapeHtml(b.desc)}</div>
        <div style="font-size:11px;color:var(--muted);margin-top:6px;word-break:break-all">${escapeHtml(b.url)}</div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px;margin-left:8px">
        <button class="small-btn" data-action="edit" data-id="${b.id}">‚úèÔ∏è Edit</button>
        <button class="small-btn" data-action="delete" data-id="${b.id}">üóëÔ∏è Delete</button>
      </div>
    `;
    adminBookList.appendChild(row);
  });
}

/* ------------------ download logic ------------------ */
function recordDownload(bookId){
  const b = books.find(x=>x.id===bookId);
  if(!b) return;
  b.downloads = (b.downloads||0) + 1;
  stats.totalDownloads = (stats.totalDownloads||0) + 1;
  saveBooks(books);
  saveStats(stats);
  renderBooks();
}

/* Try to open file via new tab (simple & reliable) */
function openUrl(url){
  try{
    const a = document.createElement('a');
    a.href = url;
    a.target = '_blank';
    a.rel = 'noopener';
    document.body.appendChild(a);
    a.click();
    a.remove();
  }catch(e){
    window.open(url,'_blank');
  }
}

/* Use event delegation for card buttons */
grid.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('button');
  if(!btn) return;
  const action = btn.dataset.action;
  if(action === 'download'){
    const id = btn.dataset.id;
    const book = books.find(x=>x.id===id);
    if(!book){ alert('Book not found'); return; }
    // open in new tab & record (fast & avoids fetch CORS issues)
    openUrl(book.url);
    recordDownload(id);
    showToast(`${book.title} ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶∂‡ßÅ‡¶∞‡ßÅ`);
  } else if(action === 'open'){
    const url = btn.dataset.url;
    if(url) openUrl(url);
  }
});

/* Download All sequentially */
document.getElementById('downloadAll').addEventListener('click', async ()=>{
  for(let i=0;i<books.length;i++){
    const b = books[i];
    openUrl(b.url);
    recordDownload(b.id);
    await sleep(800); // small gap so tabs open nicely
  }
  showToast('‡¶∏‡¶¨‡¶ó‡ßÅ‡¶≤‡ßã ‡¶´‡¶æ‡¶á‡¶≤ ‡¶ñ‡ßÅ‡¶≤‡ßá ‡¶¶‡ßá‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá (‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶æ‡¶â‡¶®‡ßç‡¶ü ‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶π‡ßü‡ßá‡¶õ‡ßá)');
});

/* ------------------ Admin: long-press to login ------------------ */
const header = document.getElementById('siteHeader');
let pressTimer = null;
let pressed = false;
header.addEventListener('touchstart', startPress);
header.addEventListener('mousedown', startPress);
header.addEventListener('touchend', cancelPress);
header.addEventListener('mouseup', cancelPress);
header.addEventListener('mouseleave', cancelPress);

function startPress(e){
  if(pressTimer) clearTimeout(pressTimer);
  pressTimer = setTimeout(()=> {
    pressed = true;
    showLoginModal();
  }, 1200); // 1.2s long-press
}
function cancelPress(e){
  if(pressTimer) clearTimeout(pressTimer);
}

/* ------------------ Modal helpers ------------------ */
const modalBackdrop = document.getElementById('modalBackdrop');
const modalContent = document.getElementById('modalContent');

function showModal(html){
  modalContent.innerHTML = html;
  modalBackdrop.style.display = 'flex';
}
function hideModal(){ modalBackdrop.style.display = 'none'; modalContent.innerHTML=''; }

/* ------------------ Login flow ------------------ */
function showLoginModal(){
  const html = `
    <h3>üîê Admin Login</h3>
    <div class="small">Enter admin password to open dashboard</div>
    <div class="row-input" style="margin-top:12px">
      <input id="adminPassInput" type="password" placeholder="Admin password">
      <button id="adminLoginBtn" class="small-btn">Login</button>
    </div>
    <div class="small" style="margin-top:10px">(‡¶°‡¶ø‡¶´‡¶≤‡ßç‡¶ü ‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶°: <code style="color:#ffd200">kiddo2025</code>)</div>
  `;
  showModal(html);
  document.getElementById('adminLoginBtn').addEventListener('click', ()=> {
    const val = document.getElementById('adminPassInput').value || '';
    const stored = loadAdmin();
    const passToCheck = (stored && stored.pass) ? stored.pass : DEFAULT_ADMIN_PASS;
    if(val === passToCheck){
      hideModal();
      openAdminPanel();
      showToast('‡¶∏‡ßç‡¶¨‡¶æ‡¶ó‡¶§ ‚Äî Admin Dashboard ‡¶ñ‡ßÅ‡¶≤‡ßá ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶≤‡ßã');
    } else {
      alert('‡¶™‡¶æ‡¶∏‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞‡ßç‡¶° ‡¶≠‡ßÅ‡¶≤ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
    }
  });
}

/* ------------------ Admin panel logic ------------------ */
function openAdminPanel(){
  adminPanel.style.display = 'block';
  adminPanel.setAttribute('aria-hidden','false');
  renderAdminList();
}
document.getElementById('closeAdmin').addEventListener('click', ()=> {
  adminPanel.style.display = 'none';
  adminPanel.setAttribute('aria-hidden','true');
});

/* Admin list buttons (edit/delete) */
adminBookList.addEventListener('click', (ev)=>{
  const btn = ev.target.closest('button');
  if(!btn) return;
  const id = btn.dataset.id;
  const action = btn.dataset.action;
  if(action==='delete'){
    if(confirm('‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§ ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶§‡ßá ‡¶ö‡¶æ‡¶®?')){
      books = books.filter(x=>x.id!==id);
      saveBooks(books);
      renderBooks();
      showToast('‡¶¨‡¶á ‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
    }
  } else if(action==='edit'){
    const b = books.find(x=>x.id===id);
    if(!b) return;
    showEditModal(b);
  }
});

/* Add new book modal */
document.getElementById('openAdd').addEventListener('click', ()=> {
  showAddModal();
});

/* ------------------ Add / Edit modals ------------------ */
function showAddModal(){
  const html = `
    <h3>‚ûï Add New Book</h3>
    <div class="small">Fill title, short description, emoji (optional), and raw URL</div>
    <div class="row-input" style="margin-top:10px">
      <input id="newTitle" placeholder="Title (e.g., ‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∏‡ßÅ‡¶≤ ‡ß¨)">
    </div>
    <div class="row-input" style="margin-top:8px">
      <input id="newEmoji" placeholder="Emoji (e.g., üìó)">
      <input id="newDesc" placeholder="Short description">
    </div>
    <div class="row-input" style="margin-top:8px">
      <input id="newURL" placeholder="Raw file URL (https://raw.githubusercontent.com/... .pdf)">
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button id="saveNew" class="small-btn">Save</button>
      <button id="cancelNew" class="small-btn">Cancel</button>
    </div>
  `;
  showModal(html);
  document.getElementById('cancelNew').addEventListener('click', hideModal);
  document.getElementById('saveNew').addEventListener('click', ()=>{
    const title = document.getElementById('newTitle').value.trim();
    const emoji = document.getElementById('newEmoji').value.trim() || 'üìï';
    const desc = document.getElementById('newDesc').value.trim() || '';
    const url = document.getElementById('newURL').value.trim();
    if(!title || !url){ alert('Title ‡¶è‡¶¨‡¶Ç URL ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá'); return; }
    const nb = { id: genId(), emoji, title, desc, url, downloads:0 };
    books.unshift(nb);
    saveBooks(books);
    renderBooks();
    hideModal();
    showToast('‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶á ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
  });
}

function showEditModal(book){
  const html = `
    <h3>‚úèÔ∏è Edit Book</h3>
    <div class="row-input" style="margin-top:10px">
      <input id="eTitle" value="${escapeHtmlAttr(book.title)}">
    </div>
    <div class="row-input" style="margin-top:8px">
      <input id="eEmoji" value="${escapeHtmlAttr(book.emoji||'')}">
      <input id="eDesc" value="${escapeHtmlAttr(book.desc||'')}">
    </div>
    <div class="row-input" style="margin-top:8px">
      <input id="eURL" value="${escapeHtmlAttr(book.url||'')}" >
    </div>
    <div style="margin-top:10px;display:flex;gap:8px">
      <button id="saveEdit" class="small-btn">Save</button>
      <button id="cancelEdit" class="small-btn">Cancel</button>
    </div>
  `;
  showModal(html);
  document.getElementById('cancelEdit').addEventListener('click', hideModal);
  document.getElementById('saveEdit').addEventListener('click', ()=>{
    const title = document.getElementById('eTitle').value.trim();
    const emoji = document.getElementById('eEmoji').value.trim() || 'üìï';
    const desc = document.getElementById('eDesc').value.trim() || '';
    const url = document.getElementById('eURL').value.trim();
    if(!title || !url){ alert('Title ‡¶è‡¶¨‡¶Ç URL ‡¶¶‡¶ø‡¶§‡ßá ‡¶π‡¶¨‡ßá'); return; }
    const idx = books.findIndex(x=>x.id===book.id);
    if(idx>=0){
      books[idx].title = title;
      books[idx].emoji = emoji;
      books[idx].desc = desc;
      books[idx].url = url;
      saveBooks(books);
      renderBooks();
      hideModal();
      showToast('‡¶¨‡¶á ‡¶∏‡¶Æ‡ßç‡¶™‡¶æ‡¶¶‡¶ø‡¶§ ‡¶π‡ßü‡ßá‡¶õ‡ßá');
    }
  });
}

/* ------------------ small utils ------------------ */
function showToast(msg, t=2500){
  const el = document.createElement('div');
  el.textContent = msg; el.style.position='fixed'; el.style.left='12px'; el.style.bottom='12px';
  el.style.background='rgba(0,0,0,0.6)'; el.style.color='#fff'; el.style.padding='10px 12px'; el.style.borderRadius='8px';
  el.style.fontSize='13px'; el.style.zIndex=9999;
  document.body.appendChild(el);
  setTimeout(()=> el.style.opacity='0.02', t-300);
  setTimeout(()=> el.remove(), t);
}
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }
function escapeHtml(str){ if(!str) return ''; return String(str).replace(/[&<>"']/g, function(m){return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[m];}); }
function escapeHtmlAttr(s){ return (s||'').replace(/"/g,'&quot;'); }

/* ------------------ initial render ------------------ */
renderBooks();

/* ------------------ small note: admin password change UI ------------------ */
/* You can change admin password by setting localStorage key 'kiddo_admin_v1' like:
   localStorage.setItem('kiddo_admin_v1', JSON.stringify({pass:'yourNewPass'}));
   Or I can add an input in the admin panel later to change it (safe).
*/

/* ------------------ helpful: open admin if url contains ?admin=1 --------------- */
if(location.search.indexOf('admin=1')!==-1){
  // quick open (for convenience)
  showLoginModal();
}
</script>
</body>
</html>
